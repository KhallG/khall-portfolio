import{S as x}from"./index-B7JP-peH.js";import{_ as I,Z as A}from"./mixin-D3UDm--6-zaESpKYn.js";import{n as v}from"./hls-Bm3F2dIq-B-FraBU5.js";const O=t=>class extends t{static shadowRootOptions={...t.shadowRootOptions};static getTemplateHTML=(e,i={})=>{const{src:u,...m}=e;return`
        <script type="application/json" id="config">
          ${JSON.stringify(i.config||{})}
        <\/script>
        ${t.getTemplateHTML(m)}
      `};#t=null;#e=null;constructor(){super(),this.#a("config")}get config(){return this.#e}set config(e){this.#e=e}attributeChangedCallback(e,i,u){e!=="src"&&super.attributeChangedCallback(e,i,u),e==="src"&&i!=u&&this.load()}#s(){var e,i;(e=this.#t)==null||e.remove(),(i=this.nativeEl)==null||i.removeEventListener("webkitcurrentplaybacktargetiswirelesschanged",this.#i),this.api&&(this.api.detachMedia(),this.api.destroy(),this.api=null)}async load(){var e,i;const u=!this.api;if(this.#s(),!!this.src){if(u&&!this.#e&&(this.#e=JSON.parse(((e=this.shadowRoot.getElementById("config"))==null?void 0:e.textContent)||"{}")),v.isSupported()){switch(await Promise.resolve(),this.api=new v({liveDurationInfinity:!0,autoStartLoad:!1,...this.config}),this.api.loadSource(this.src),this.api.attachMedia(this.nativeEl),this.nativeEl.preload){case"none":{const o=()=>this.api.startLoad();this.nativeEl.addEventListener("play",o,{once:!0}),this.api.on(v.Events.DESTROYING,()=>{this.nativeEl.removeEventListener("play",o)});break}case"metadata":{const o=this.api.config.maxBufferLength,r=this.api.config.maxBufferSize;this.api.config.maxBufferLength=1,this.api.config.maxBufferSize=1;const l=()=>{this.api.config.maxBufferLength=o,this.api.config.maxBufferSize=r};this.nativeEl.addEventListener("play",l,{once:!0}),this.api.on(v.Events.DESTROYING,()=>{this.nativeEl.removeEventListener("play",l)}),this.api.startLoad();break}default:this.api.startLoad()}this.nativeEl.webkitCurrentPlaybackTargetIsWireless&&this.api.stopLoad(),this.nativeEl.addEventListener("webkitcurrentplaybacktargetiswirelesschanged",this.#i),this.#t=document.createElement("source"),this.#t.setAttribute("type","application/x-mpegURL"),this.#t.setAttribute("src",this.src),this.nativeEl.disableRemotePlayback=!1,this.nativeEl.append(this.#t);const m=new WeakMap;this.api.on(v.Events.MANIFEST_PARSED,(o,r)=>{this.nativeEl.autoplay&&this.nativeEl.paused&&this.nativeEl.play().catch(c=>{console.warn("Autoplay failed:",c)}),T();let l=this.videoTracks.getTrackById("main");l||(l=this.addVideoTrack("main"),l.id="main",l.selected=!0);for(const[c,s]of r.levels.entries()){const E=l.addRendition(s.url[0],s.width,s.height,s.videoCodec,s.bitrate);m.set(s,`${c}`),E.id=`${c}`}for(let[c,s]of r.audioTracks.entries()){const E=s.default?"main":"alternative",y=this.addAudioTrack(E,s.name,s.lang);y.id=`${c}`,s.default&&(y.enabled=!0)}}),this.audioTracks.addEventListener("change",()=>{var o;const r=+((o=[...this.audioTracks].find(c=>c.enabled))==null?void 0:o.id),l=this.api.audioTracks.map(c=>c.id);r!=this.api.audioTrack&&l.includes(r)&&(this.api.audioTrack=r)}),this.api.on(v.Events.LEVELS_UPDATED,(o,r)=>{const l=this.videoTracks[this.videoTracks.selectedIndex??0];if(!l)return;const c=r.levels.map(s=>m.get(s));for(const s of this.videoRenditions)s.id&&!c.includes(s.id)&&l.removeRendition(s)});const L=o=>{const r=o.target.selectedIndex;r!=this.api.nextLevel&&(this.api.nextLevel=r)};(i=this.videoRenditions)==null||i.addEventListener("change",L);const T=()=>{for(const o of this.videoTracks)this.removeVideoTrack(o);for(const o of this.audioTracks)this.removeAudioTrack(o)};this.api.once(v.Events.DESTROYING,T);return}await Promise.resolve(),this.nativeEl.canPlayType("application/vnd.apple.mpegurl")&&(this.nativeEl.src=this.src)}}#i=()=>{var e,i,u;(e=this.nativeEl)!=null&&e.webkitCurrentPlaybackTargetIsWireless?(i=this.api)==null||i.stopLoad():(u=this.api)==null||u.startLoad()};#a(e){if(Object.prototype.hasOwnProperty.call(this,e)){const i=this[e];delete this[e],this[e]=i}}},M=O(I(A));globalThis.customElements&&!globalThis.customElements.get("hls-video")&&globalThis.customElements.define("hls-video",M);var P=M,H=new Set(["style","children","ref","key","suppressContentEditableWarning","suppressHydrationWarning","dangerouslySetInnerHTML"]),B={className:"class",htmlFor:"for"};function N(t){return t.toLowerCase()}function R(t){if(typeof t=="boolean")return t?"":void 0;if(typeof t!="function"&&!(typeof t=="object"&&t!==null))return t}function D({react:t,tagName:e,elementClass:i,events:u,displayName:m,defaultProps:L,toAttributeName:T=N,toAttributeValue:o=R}){const r=Number.parseInt(t.version)>=19,l=t.forwardRef((c,s)=>{var E,y;const g=t.useRef(null),k=t.useRef(new Map),w={},S={},p={},b={};for(const[a,n]of Object.entries(c)){if(H.has(a)){p[a]=n;continue}const d=T(B[a]??a);if(i.prototype&&a in i.prototype&&!(a in(((E=globalThis.HTMLElement)==null?void 0:E.prototype)??{}))&&!((y=i.observedAttributes)!=null&&y.some(f=>f===d))){b[a]=n;continue}if(a.startsWith("on")){w[a]=n;continue}const h=o(n);if(d&&h!=null&&(S[d]=String(h),r||(p[d]=h)),d&&r){const f=R(n);h!==f?p[d]=h:p[d]=n}}if(typeof window<"u"){for(const a in w){const n=w[a],d=a.endsWith("Capture"),h=(u?.[a]??a.slice(2).toLowerCase()).slice(0,d?-7:void 0);t.useLayoutEffect(()=>{const f=g?.current;if(!(!f||typeof n!="function"))return f.addEventListener(h,n,d),()=>{f.removeEventListener(h,n,d)}},[g?.current,n])}t.useLayoutEffect(()=>{if(g.current===null)return;const a=new Map;for(const n in b)C(g.current,n,b[n]),k.current.delete(n),a.set(n,b[n]);for(const[n,d]of k.current)C(g.current,n,void 0);k.current=a})}if(typeof window>"u"&&i?.getTemplateHTML&&i?.shadowRootOptions){const{mode:a,delegatesFocus:n}=i.shadowRootOptions,d=t.createElement("template",{shadowrootmode:a,shadowrootdelegatesfocus:n,dangerouslySetInnerHTML:{__html:i.getTemplateHTML(S,c)}});p.children=[d,p.children]}return t.createElement(e,{...L,...p,ref:t.useCallback(a=>{g.current=a,typeof s=="function"?s(a):s!==null&&(s.current=a)},[s])})});return l.displayName=m??i.name,l}function C(t,e,i){var u;t[e]=i,i==null&&e in(((u=globalThis.HTMLElement)==null?void 0:u.prototype)??{})&&t.removeAttribute(e)}var $=D({react:x,tagName:"hls-video",elementClass:P,toAttributeName(t){return t==="muted"?"":t==="defaultMuted"?"muted":N(t)}});export{$ as default};
