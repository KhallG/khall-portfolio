const $=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting","waitingforkey","resize","enterpictureinpicture","leavepictureinpicture","webkitbeginfullscreen","webkitendfullscreen","webkitpresentationmodechanged"],A=["autopictureinpicture","disablepictureinpicture","disableremoteplayback","autoplay","controls","controlslist","crossorigin","loop","muted","playsinline","poster","preload","src"];function I(e){return`
    <style>
      :host {
        display: inline-flex;
        line-height: 0;
        flex-direction: column;
        justify-content: end;
      }

      audio {
        width: 100%;
      }
    </style>
    <slot name="media">
      <audio${O(e)}></audio>
    </slot>
    <slot></slot>
  `}function H(e){return`
    <style>
      :host {
        display: inline-block;
        line-height: 0;
      }

      video {
        max-width: 100%;
        max-height: 100%;
        min-width: 100%;
        min-height: 100%;
        object-fit: var(--media-object-fit, contain);
        object-position: var(--media-object-position, 50% 50%);
      }

      video::-webkit-media-text-track-container {
        transform: var(--media-webkit-text-track-transform);
        transition: var(--media-webkit-text-track-transition);
      }
    </style>
    <slot name="media">
      <video${O(e)}></video>
    </slot>
    <slot></slot>
  `}function x(e,{tag:t,is:i}){const r=globalThis.document?.createElement?.(t,{is:i}),a=r?z(r):[];return class m extends e{static getTemplateHTML=t.endsWith("audio")?I:H;static shadowRootOptions={mode:"open"};static Events=$;static#t=!1;static get observedAttributes(){return m.#i(),[...r?.constructor?.observedAttributes??[],...A]}static#i(){if(this.#t)return;this.#t=!0;const n=new Set(this.observedAttributes);n.delete("muted");for(const o of a)if(!(o in this.prototype))if(typeof r[o]=="function")this.prototype[o]=function(...d){return this.#s(),this.call?this.call(o,...d):this.nativeEl?.[o]?.apply(this.nativeEl,d)};else{const d={get(){this.#s();const c=o.toLowerCase();if(n.has(c)){const u=this.getAttribute(c);return u===null?!1:u===""?!0:u}return this.get?.(o)??this.nativeEl?.[o]}};o!==o.toUpperCase()&&(d.set=function(c){this.#s();const u=o.toLowerCase();if(n.has(u)){c===!0||c===!1||c==null?this.toggleAttribute(u,!!c):this.setAttribute(u,c);return}if(this.set){this.set(o,c);return}this.nativeEl&&(this.nativeEl[o]=c)}),Object.defineProperty(this.prototype,o,d)}}#e=!1;#n=null;#r=new Map;#o;get;set;call;get nativeEl(){return this.#s(),this.#n??this.querySelector(":scope > [slot=media]")??this.querySelector(t)??this.shadowRoot?.querySelector(t)??null}set nativeEl(n){this.#n=n}get defaultMuted(){return this.hasAttribute("muted")}set defaultMuted(n){this.toggleAttribute("muted",n)}get src(){return this.getAttribute("src")}set src(n){this.setAttribute("src",`${n}`)}get preload(){return this.getAttribute("preload")??this.nativeEl?.preload}set preload(n){this.setAttribute("preload",`${n}`)}#s(){this.#e||(this.#e=!0,this.init())}init(){if(!this.shadowRoot){this.attachShadow({mode:"open"});const n=C(this.attributes);i&&(n.is=i),t&&(n.part=t),this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(n)}this.nativeEl.muted=this.hasAttribute("muted");for(const n of a)this.#h(n);this.#o=new MutationObserver(this.#c.bind(this)),this.shadowRoot.addEventListener("slotchange",()=>this.#a()),this.#a();for(const n of this.constructor.Events)this.shadowRoot.addEventListener(n,this,!0)}handleEvent(n){n.target===this.nativeEl&&this.dispatchEvent(new CustomEvent(n.type,{detail:n.detail}))}#a(){const n=new Map(this.#r);(this.shadowRoot?.querySelector("slot:not([name])")?.assignedElements({flatten:!0}).filter(o=>["track","source"].includes(o.localName))).forEach(o=>{n.delete(o);let d=this.#r.get(o);d||(d=o.cloneNode(),this.#r.set(o,d),this.#o?.observe(o,{attributes:!0})),this.nativeEl?.append(d),this.#d(d)}),n.forEach((o,d)=>{o.remove(),this.#r.delete(d)})}#c(n){for(const o of n)if(o.type==="attributes"){const{target:d,attributeName:c}=o,u=this.#r.get(d);u&&c&&(u.setAttribute(c,d.getAttribute(c)??""),this.#d(u))}}#d(n){n&&n.localName==="track"&&n.default&&(n.kind==="chapters"||n.kind==="metadata")&&n.track.mode==="disabled"&&(n.track.mode="hidden")}#h(n){if(Object.prototype.hasOwnProperty.call(this,n)){const o=this[n];delete this[n],this[n]=o}}attributeChangedCallback(n,o,d){this.#s(),this.#u(n,o,d)}#u(n,o,d){["id","class"].includes(n)||!m.observedAttributes.includes(n)&&this.constructor.observedAttributes.includes(n)||(d===null?this.nativeEl?.removeAttribute(n):this.nativeEl?.getAttribute(n)!==d&&this.nativeEl?.setAttribute(n,d))}connectedCallback(){this.#s()}}}function z(e){const t=[];for(let i=Object.getPrototypeOf(e);i&&i!==HTMLElement.prototype;i=Object.getPrototypeOf(i)){const r=Object.getOwnPropertyNames(i);t.push(...r)}return t}function O(e){let t="";for(const i in e){if(!A.includes(i))continue;const r=e[i];r===""?t+=` ${i}`:t+=` ${i}="${r}"`}return t}function C(e){const t={};for(const i of e)t[i.name]=i.value;return t}const Z=x(globalThis.HTMLElement??class{},{tag:"video"});x(globalThis.HTMLElement??class{},{tag:"audio"});class f extends Event{track;constructor(t,i){super(t),this.track=i.track}}const k=new WeakMap;function s(e){return k.get(e)??B(e,{})}function B(e,t){let i=k.get(e);return i||k.set(e,i={}),Object.assign(i,t)}function b(e,t){const i=e.videoTracks;s(t).media=e,s(t).renditionSet||(s(t).renditionSet=new Set);const r=s(i).trackSet;r.add(t);const a=r.size-1;a in E.prototype||Object.defineProperty(E.prototype,a,{get(){return[...s(this).trackSet][a]}}),queueMicrotask(()=>{i.dispatchEvent(new f("addtrack",{track:t}))})}function y(e){const t=s(e).media?.videoTracks;t&&(s(t).trackSet.delete(e),queueMicrotask(()=>{t.dispatchEvent(new f("removetrack",{track:e}))}))}function N(e){const t=s(e).media.videoTracks??[];let i=!1;for(const r of t)r!==e&&(r.selected=!1,i=!0);if(i){if(s(t).changeRequested)return;s(t).changeRequested=!0,queueMicrotask(()=>{delete s(t).changeRequested,t.dispatchEvent(new Event("change"))})}}class E extends EventTarget{#t;#i;#e;constructor(){super(),s(this).trackSet=new Set}get#n(){return s(this).trackSet}[Symbol.iterator](){return this.#n.values()}get length(){return this.#n.size}getTrackById(t){return[...this.#n].find(i=>i.id===t)??null}get selectedIndex(){return[...this.#n].findIndex(t=>t.selected)}get onaddtrack(){return this.#t}set onaddtrack(t){this.#t&&(this.removeEventListener("addtrack",this.#t),this.#t=void 0),typeof t=="function"&&(this.#t=t,this.addEventListener("addtrack",t))}get onremovetrack(){return this.#i}set onremovetrack(t){this.#i&&(this.removeEventListener("removetrack",this.#i),this.#i=void 0),typeof t=="function"&&(this.#i=t,this.addEventListener("removetrack",t))}get onchange(){return this.#e}set onchange(t){this.#e&&(this.removeEventListener("change",this.#e),this.#e=void 0),typeof t=="function"&&(this.#e=t,this.addEventListener("change",t))}}class g extends Event{rendition;constructor(t,i){super(t),this.rendition=i.rendition}}function V(e,t){const i=s(e).media.videoRenditions;s(t).media=s(e).media,s(t).track=e;const r=s(e).renditionSet;r.add(t);const a=r.size-1;a in w.prototype||Object.defineProperty(w.prototype,a,{get(){return l(this)[a]}}),queueMicrotask(()=>{e.selected&&i.dispatchEvent(new g("addrendition",{rendition:t}))})}function W(e){const t=s(e).media.videoRenditions,i=s(e).track;s(i).renditionSet.delete(e),queueMicrotask(()=>{s(e).track.selected&&t.dispatchEvent(new g("removerendition",{rendition:e}))})}function D(e){const t=s(e).media.videoRenditions;!t||s(t).changeRequested||(s(t).changeRequested=!0,queueMicrotask(()=>{delete s(t).changeRequested,s(e).track.selected&&t.dispatchEvent(new Event("change"))}))}function l(e){return[...s(e).media.videoTracks].filter(t=>t.selected).flatMap(t=>[...s(t).renditionSet])}class w extends EventTarget{#t;#i;#e;[Symbol.iterator](){return l(this).values()}get length(){return l(this).length}getRenditionById(t){return l(this).find(i=>`${i.id}`==`${t}`)??null}get selectedIndex(){return l(this).findIndex(t=>t.selected)}set selectedIndex(t){for(const[i,r]of l(this).entries())r.selected=i===t}get onaddrendition(){return this.#t}set onaddrendition(t){this.#t&&(this.removeEventListener("addrendition",this.#t),this.#t=void 0),typeof t=="function"&&(this.#t=t,this.addEventListener("addrendition",t))}get onremoverendition(){return this.#i}set onremoverendition(t){this.#i&&(this.removeEventListener("removerendition",this.#i),this.#i=void 0),typeof t=="function"&&(this.#i=t,this.addEventListener("removerendition",t))}get onchange(){return this.#e}set onchange(t){this.#e&&(this.removeEventListener("change",this.#e),this.#e=void 0),typeof t=="function"&&(this.#e=t,this.addEventListener("change",t))}}class U{src;id;width;height;bitrate;frameRate;codec;#t=!1;get selected(){return this.#t}set selected(t){this.#t!==t&&(this.#t=t,D(this))}}class j{id;kind;label="";language="";sourceBuffer;#t=!1;addRendition(t,i,r,a,h,n){const o=new U;return o.src=t,o.width=i,o.height=r,o.frameRate=n,o.bitrate=h,o.codec=a,V(this,o),o}removeRendition(t){W(t)}get selected(){return this.#t}set selected(t){this.#t!==t&&(this.#t=t,t===!0&&N(this))}}function F(e,t){const i=s(e).media.audioRenditions;s(t).media=s(e).media,s(t).track=e;const r=s(e).renditionSet;r.add(t);const a=r.size-1;a in T.prototype||Object.defineProperty(T.prototype,a,{get(){return v(this)[a]}}),queueMicrotask(()=>{e.enabled&&i.dispatchEvent(new g("addrendition",{rendition:t}))})}function G(e){const t=s(e).media.audioRenditions,i=s(e).track;s(i).renditionSet.delete(e),queueMicrotask(()=>{s(e).track.enabled&&t.dispatchEvent(new g("removerendition",{rendition:e}))})}function J(e){const t=s(e).media.audioRenditions;!t||s(t).changeRequested||(s(t).changeRequested=!0,queueMicrotask(()=>{delete s(t).changeRequested,s(e).track.enabled&&t.dispatchEvent(new Event("change"))}))}function v(e){return[...s(e).media.audioTracks].filter(t=>t.enabled).flatMap(t=>[...s(t).renditionSet])}class T extends EventTarget{#t;#i;#e;[Symbol.iterator](){return v(this).values()}get length(){return v(this).length}getRenditionById(t){return v(this).find(i=>`${i.id}`==`${t}`)??null}get selectedIndex(){return v(this).findIndex(t=>t.selected)}set selectedIndex(t){for(const[i,r]of v(this).entries())r.selected=i===t}get onaddrendition(){return this.#t}set onaddrendition(t){this.#t&&(this.removeEventListener("addrendition",this.#t),this.#t=void 0),typeof t=="function"&&(this.#t=t,this.addEventListener("addrendition",t))}get onremoverendition(){return this.#i}set onremoverendition(t){this.#i&&(this.removeEventListener("removerendition",this.#i),this.#i=void 0),typeof t=="function"&&(this.#i=t,this.addEventListener("removerendition",t))}get onchange(){return this.#e}set onchange(t){this.#e&&(this.removeEventListener("change",this.#e),this.#e=void 0),typeof t=="function"&&(this.#e=t,this.addEventListener("change",t))}}class K{src;id;bitrate;codec;#t=!1;get selected(){return this.#t}set selected(t){this.#t!==t&&(this.#t=t,J(this))}}function L(e,t){const i=e.audioTracks;s(t).media=e,s(t).renditionSet||(s(t).renditionSet=new Set);const r=s(i).trackSet;r.add(t);const a=r.size-1;a in S.prototype||Object.defineProperty(S.prototype,a,{get(){return[...s(this).trackSet][a]}}),queueMicrotask(()=>{i.dispatchEvent(new f("addtrack",{track:t}))})}function R(e){const t=s(e).media?.audioTracks;t&&(s(t).trackSet.delete(e),queueMicrotask(()=>{t.dispatchEvent(new f("removetrack",{track:e}))}))}function Q(e){const t=s(e).media.audioTracks;!t||s(t).changeRequested||(s(t).changeRequested=!0,queueMicrotask(()=>{delete s(t).changeRequested,t.dispatchEvent(new Event("change"))}))}class S extends EventTarget{#t;#i;#e;constructor(){super(),s(this).trackSet=new Set}get#n(){return s(this).trackSet}[Symbol.iterator](){return this.#n.values()}get length(){return this.#n.size}getTrackById(t){return[...this.#n].find(i=>i.id===t)??null}get onaddtrack(){return this.#t}set onaddtrack(t){this.#t&&(this.removeEventListener("addtrack",this.#t),this.#t=void 0),typeof t=="function"&&(this.#t=t,this.addEventListener("addtrack",t))}get onremovetrack(){return this.#i}set onremovetrack(t){this.#i&&(this.removeEventListener("removetrack",this.#i),this.#i=void 0),typeof t=="function"&&(this.#i=t,this.addEventListener("removetrack",t))}get onchange(){return this.#e}set onchange(t){this.#e&&(this.removeEventListener("change",this.#e),this.#e=void 0),typeof t=="function"&&(this.#e=t,this.addEventListener("change",t))}}class P{id;kind;label="";language="";sourceBuffer;#t=!1;addRendition(t,i,r){const a=new K;return a.src=t,a.codec=i,a.bitrate=r,F(this,a),a}removeRendition(t){G(t)}get enabled(){return this.#t}set enabled(t){this.#t!==t&&(this.#t=t,Q(this))}}const M=p(globalThis.HTMLMediaElement,"video"),q=p(globalThis.HTMLMediaElement,"audio");function _(e){if(!e?.prototype)return e;const t=p(e,"video");(!t||`${t}`.includes("[native code]"))&&Object.defineProperty(e.prototype,"videoTracks",{get(){return X(this)}});const i=p(e,"audio");(!i||`${i}`.includes("[native code]"))&&Object.defineProperty(e.prototype,"audioTracks",{get(){return Y(this)}}),"addVideoTrack"in e.prototype||(e.prototype.addVideoTrack=function(h,n="",o=""){const d=new j;return d.kind=h,d.label=n,d.language=o,b(this,d),d}),"removeVideoTrack"in e.prototype||(e.prototype.removeVideoTrack=y),"addAudioTrack"in e.prototype||(e.prototype.addAudioTrack=function(h,n="",o=""){const d=new P;return d.kind=h,d.label=n,d.language=o,L(this,d),d}),"removeAudioTrack"in e.prototype||(e.prototype.removeAudioTrack=R),"videoRenditions"in e.prototype||Object.defineProperty(e.prototype,"videoRenditions",{get(){return r(this)}});const r=h=>{let n=s(h).videoRenditions;return n||(n=new w,s(n).media=h,s(h).videoRenditions=n),n};"audioRenditions"in e.prototype||Object.defineProperty(e.prototype,"audioRenditions",{get(){return a(this)}});const a=h=>{let n=s(h).audioRenditions;return n||(n=new T,s(n).media=h,s(h).audioRenditions=n),n};return e}function p(e,t){if(e?.prototype)return Object.getOwnPropertyDescriptor(e.prototype,`${t}Tracks`)?.get}function X(e){let t=s(e).videoTracks;if(!t&&(t=new E,s(e).videoTracks=t,M)){const i=M.call(e.nativeEl??e);for(const r of i)b(e,r);i.addEventListener("change",()=>{t.dispatchEvent(new Event("change"))}),i.addEventListener("addtrack",r=>{if([...t].some(a=>a instanceof j)){for(const a of i)y(a);return}b(e,r.track)}),i.addEventListener("removetrack",r=>{y(r.track)})}return t}function Y(e){let t=s(e).audioTracks;if(!t&&(t=new S,s(e).audioTracks=t,q)){const i=q.call(e.nativeEl??e);for(const r of i)L(e,r);i.addEventListener("change",()=>{t.dispatchEvent(new Event("change"))}),i.addEventListener("addtrack",r=>{if([...t].some(a=>a instanceof P)){for(const a of i)R(a);return}L(e,r.track)}),i.addEventListener("removetrack",r=>{R(r.track)})}return t}export{Z,_};
